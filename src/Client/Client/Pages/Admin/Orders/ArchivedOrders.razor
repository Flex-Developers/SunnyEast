@page "/admin/orders/archive"
@attribute [Authorize(Roles = "Administrator,Salesman")]

@using Application.Contract.Order.Responses
@using Client.Components.Common
@using Client.Infrastructure.Services.Order
@using Microsoft.AspNetCore.Authorization
@inject IOrderService OrderService
@inject NavigationManager Navigation

<MudPaper Class="mx-auto mt-4 pa-4" MaxWidth="1280px">

    <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-4">
        Архив заказов
    </MudText>

    <MudTable Items="_orders" Hover Dense Bordered FixedHeader Breakpoint="Breakpoint.Sm"
              Class="border rounded-lg">

        <HeaderContent>
            <MudTh Class="text-center">Номер заказа</MudTh>
            <MudTh class="text-center">Магазин</MudTh>
            <MudTh class="text-center">Статус</MudTh>
            <MudTh class="text-center">Сумма</MudTh>
            <MudTh class="text-center" Style="width:140px">Действия</MudTh>
        </HeaderContent>

        <RowTemplate>
            <MudTd>@context.OrderNumber</MudTd>
            <MudTd>@context.Shop!.Address</MudTd>
            <MudTd><OrderStatusChip Status="@context.Status"/></MudTd>
            <MudTd Class="text-right">@($"{context.Sum:N2} ₽")</MudTd>
            <MudTd Class="d-flex justify-center" Style="gap:8px">
                <MudButton Variant="Variant.Outlined"
                           Color="Color.Primary" Size="Size.Small"
                           StartIcon="@Icons.Material.Filled.Visibility"
                           @onclick="@(() => Navigation.NavigateTo($"/admin/orders/{context.Slug}"))">
                    Подробнее
                </MudButton>
            </MudTd>
        </RowTemplate>
    </MudTable>
</MudPaper>

@code {
    private List<OrderResponse> _orders = [];

    protected override async Task OnInitializedAsync()
    {
        _orders = (await OrderService.GetAsync(string.Empty, archived: true)).ToList();
    }
}